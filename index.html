<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å›¾ä¹¦é¦†æ™ºèƒ½é—®ç­”åŠ©æ‰‹ - å¿«é€Ÿè§£ç­”å€Ÿè¿˜ä¹¦ã€å¼€æ”¾æ—¶é—´ã€è®¾å¤‡æŠ¥ä¿®ç­‰é—®é¢˜">
    <title>å›¾ä¹¦é¦†æ™ºèƒ½é—®ç­”åŠ©æ‰‹</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #f9fafb;
            min-height: 100vh;
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        .header {
            background: #2563eb;
            color: white;
            padding: 16px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1536px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
            font-weight: bold;
        }
        
        .mode-toggle-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #1d4ed8;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .mode-toggle-btn:hover {
            background: #1e40af;
        }
        
        /* ä¸»å®¹å™¨ */
        .main-container {
            height: calc(100vh - 72px);
            overflow: hidden;
        }
        
        /* ç”¨æˆ·ç•Œé¢ */
        .user-view {
            max-width: 1024px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 16px;
        }
        
        .welcome-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 24px;
            margin-bottom: 16px;
        }
        
        .welcome-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .welcome-text {
            color: #6b7280;
            margin-bottom: 16px;
        }
        
        .quick-questions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            font-size: 14px;
        }
        
        .quick-question-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #374151;
        }
        
        .icon-blue {
            color: #2563eb;
        }
        
        /* æ¶ˆæ¯åˆ—è¡¨ */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 16px;
        }
        
        .messages-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .message {
            display: flex;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message.user {
            justify-content: flex-end;
        }
        
        .message-content {
            max-width: 66.666667%;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .message.user .message-content {
            background: #2563eb;
            color: white;
        }
        
        .message.bot .message-content {
            background: white;
        }
        
        .message-text {
            white-space: pre-wrap;
        }
        
        .feedback-link {
            display: inline-block;
            margin-top: 12px;
            padding: 8px 16px;
            background: #2563eb;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background 0.3s;
        }
        
        .feedback-link:hover {
            background: #1d4ed8;
        }
        
        .message-time {
            font-size: 12px;
            margin-top: 8px;
            opacity: 0.7;
        }
        
        /* è¾“å…¥æ¡† */
        .input-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            padding: 16px;
        }
        
        .input-wrapper {
            display: flex;
            gap: 8px;
        }
        
        .message-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }
        
        .message-input:focus {
            border-color: #2563eb;
        }
        
        .send-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .send-button:hover {
            background: #1d4ed8;
        }
        
        /* ç®¡ç†å‘˜ç•Œé¢ */
        .admin-view {
            max-width: 1536px;
            margin: 0 auto;
            padding: 24px;
            overflow-y: auto;
            height: 100%;
        }
        
        .admin-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .admin-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 16px;
        }
        
        .section {
            margin-bottom: 24px;
            padding: 16px;
            border-radius: 8px;
        }
        
        .section-blue {
            background: #eff6ff;
        }
        
        .section-green {
            background: #f0fdf4;
        }
        
        .section-title {
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .section-description {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 12px;
        }
        
        .file-input-wrapper {
            position: relative;
        }
        
        .file-input {
            display: block;
            width: 100%;
            font-size: 14px;
            color: #6b7280;
        }
        
        .file-input::file-selector-button {
            margin-right: 16px;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: #2563eb;
            color: white;
            cursor: pointer;
        }
        
        .file-input::file-selector-button:hover {
            background: #1d4ed8;
        }
        
        .form-input {
            flex: 1;
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }
        
        .form-input:focus {
            border-color: #2563eb;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
        }
        
        .btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn-green {
            background: #16a34a;
            color: white;
        }
        
        .btn-green:hover {
            background: #15803d;
        }
        
        .btn-gray {
            background: #6b7280;
            color: white;
        }
        
        .btn-gray:hover {
            background: #4b5563;
        }
        
        .btn-red {
            background: #dc2626;
            color: white;
        }
        
        .btn-red:hover {
            background: #b91c1c;
        }
        
        .knowledge-list-title {
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .knowledge-item {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            transition: box-shadow 0.3s;
        }
        
        .knowledge-item:hover {
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        
        .knowledge-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .knowledge-title {
            font-weight: 600;
            font-size: 18px;
        }
        
        .delete-btn {
            color: #dc2626;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .delete-btn:hover {
            color: #991b1b;
        }
        
        .knowledge-keywords {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .knowledge-answer {
            font-size: 14px;
            color: #374151;
            white-space: pre-wrap;
            background: #f9fafb;
            padding: 12px;
            border-radius: 4px;
        }
        
        /* å›¾æ ‡ */
        .icon {
            width: 16px;
            height: 16px;
            display: inline-block;
        }
        
        .icon-lg {
            width: 20px;
            height: 20px;
        }
        
        .icon-xl {
            width: 24px;
            height: 24px;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .quick-questions-grid {
                grid-template-columns: 1fr;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .admin-view {
                padding: 16px;
            }
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <header class="header">
        <div class="header-content">
            <div class="header-title">
                <svg class="icon-xl" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
                <span>å›¾ä¹¦é¦†æ™ºèƒ½é—®ç­”åŠ©æ‰‹</span>
            </div>
            <button class="mode-toggle-btn" onclick="toggleMode()">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span id="modeText">ç®¡ç†å‘˜æ¨¡å¼</span>
            </button>
        </div>
    </header>

    <!-- ä¸»å®¹å™¨ -->
    <main class="main-container">
        <!-- ç”¨æˆ·ç•Œé¢ -->
        <div id="userView" class="user-view">
            <!-- æ¬¢è¿å¡ç‰‡ -->
            <div id="welcomeCard" class="welcome-card">
                <h2 class="welcome-title">
                    <svg class="icon-lg icon-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    æ‚¨å¥½ï¼æˆ‘æ˜¯å›¾ä¹¦é¦†æ™ºèƒ½åŠ©æ‰‹
                </h2>
                <p class="welcome-text">æˆ‘å¯ä»¥å¸®æ‚¨è§£ç­”ä»¥ä¸‹é—®é¢˜ï¼š</p>
                <div class="quick-questions-grid">
                    <div class="quick-question-item">
                        <svg class="icon icon-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span>å¼€æ”¾æ—¶é—´</span>
                    </div>
                    <div class="quick-question-item">
                        <svg class="icon icon-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                        <span>å€Ÿè¿˜ä¹¦æµç¨‹</span>
                    </div>
                    <div class="quick-question-item">
                        <svg class="icon icon-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        </svg>
                        <span>è®¾å¤‡æŠ¥ä¿®</span>
                    </div>
                    <div class="quick-question-item">
                        <svg class="icon icon-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        <span>åº§ä½é¢„çº¦</span>
                    </div>
                </div>
            </div>

            <!-- æ¶ˆæ¯å®¹å™¨ -->
            <div id="messagesContainer" class="messages-container hidden">
                <div id="messagesList" class="messages-list"></div>
            </div>

            <!-- è¾“å…¥æ¡† -->
            <div class="input-card">
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        id="userInput" 
                        class="message-input" 
                        placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
                        onkeypress="handleKeyPress(event)"
                    >
                    <button class="send-button" onclick="sendMessage()">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                        </svg>
                        <span>å‘é€</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ç®¡ç†å‘˜ç•Œé¢ -->
        <div id="adminView" class="admin-view hidden">
            <div class="admin-card">
                <h2 class="admin-title">çŸ¥è¯†åº“ç®¡ç†</h2>
                
                <!-- å¯¼å…¥Excel -->
                <div class="section section-blue">
                    <h3 class="section-title">ğŸ“Š å¯¼å…¥ExcelçŸ¥è¯†åº“</h3>
                    <p class="section-description">
                        Excelæ–‡ä»¶éœ€åŒ…å«ä¸‰åˆ—ï¼š<strong>é—®é¢˜æ ‡é¢˜</strong>ã€<strong>å…³é”®è¯</strong>ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ã€<strong>ç­”æ¡ˆ</strong>
                    </p>
                    <input 
                        type="file" 
                        id="excelFile" 
                        class="file-input" 
                        accept=".xlsx,.xls"
                        onchange="handleExcelUpload(event)"
                    >
                </div>

                <!-- é—®å·é“¾æ¥è®¾ç½® -->
                <div class="section section-green">
                    <h3 class="section-title">ğŸ”— é—®å·é“¾æ¥è®¾ç½®</h3>
                    <div class="button-group">
                        <input 
                            type="text" 
                            id="formUrl" 
                            class="form-input" 
                            placeholder="è¾“å…¥é—®å·é“¾æ¥..."
                        >
                        <button class="btn btn-green" onclick="saveFormUrl()">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                            </svg>
                            <span>ä¿å­˜</span>
                        </button>
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
                    <button class="btn btn-gray" onclick="resetKnowledge()">
                        é‡ç½®ä¸ºé»˜è®¤çŸ¥è¯†åº“
                    </button>
                </div>

                <!-- çŸ¥è¯†åº“åˆ—è¡¨ -->
                <div>
                    <h3 class="knowledge-list-title">å½“å‰çŸ¥è¯†åº“ï¼ˆ<span id="knowledgeCount">0</span> æ¡ï¼‰</h3>
                    <div id="knowledgeList"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // é»˜è®¤çŸ¥è¯†åº“
        const defaultKnowledge = [
            {
                question: "å›¾ä¹¦é¦†å¼€æ”¾æ—¶é—´",
                keywords: ["å¼€æ”¾æ—¶é—´", "è¥ä¸šæ—¶é—´", "å‡ ç‚¹å¼€é—¨", "å‡ ç‚¹å…³é—¨", "å¼€é¦†", "é—­é¦†", "ä»€ä¹ˆæ—¶å€™å¼€"],
                answer: "å›¾ä¹¦é¦†å¼€æ”¾æ—¶é—´ï¼š\nå‘¨ä¸€è‡³å‘¨äº”ï¼š8:00 - 22:00\nå‘¨å…­è‡³å‘¨æ—¥ï¼š9:00 - 18:00\næ³•å®šèŠ‚å‡æ—¥ï¼š9:00 - 17:00"
            },
            {
                question: "å€Ÿä¹¦æµç¨‹",
                keywords: ["å€Ÿä¹¦", "æ€ä¹ˆå€Ÿ", "å€Ÿé˜…æµç¨‹", "å¦‚ä½•å€Ÿä¹¦", "å€Ÿé˜…"],
                answer: "å€Ÿä¹¦æµç¨‹ï¼š\n1. ä½¿ç”¨å­¦ç”Ÿè¯æˆ–å€Ÿä¹¦å¡åœ¨è‡ªåŠ©å€Ÿè¿˜æœºä¸Šåˆ·å¡\n2. å°†å›¾ä¹¦æ”¾åœ¨æ‰«æåŒº\n3. ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å¹¶åŠç†å€Ÿé˜…\n4. æ‰“å°å€Ÿä¹¦å‡­æ¡\n\næ¯äººæœ€å¤šå¯å€Ÿ10æœ¬ï¼Œå€ŸæœŸ30å¤©"
            },
            {
                question: "è¿˜ä¹¦æµç¨‹",
                keywords: ["è¿˜ä¹¦", "æ€ä¹ˆè¿˜", "å½’è¿˜å›¾ä¹¦", "å¦‚ä½•è¿˜ä¹¦", "å½’è¿˜"],
                answer: "è¿˜ä¹¦æµç¨‹ï¼š\n1. åœ¨è‡ªåŠ©å€Ÿè¿˜æœºä¸Šé€‰æ‹©'è¿˜ä¹¦'\n2. å°†å›¾ä¹¦æ”¾åœ¨æ‰«æåŒº\n3. ç³»ç»Ÿç¡®è®¤åå³å®Œæˆå½’è¿˜\n\n24å°æ—¶è¿˜ä¹¦ç®±ä½ç½®ï¼šå›¾ä¹¦é¦†ä¸€æ¥¼å¤§å…ä¸œä¾§"
            },
            {
                question: "è®¾å¤‡æ•…éšœæŠ¥ä¿®",
                keywords: ["æŠ¥ä¿®", "è®¾å¤‡åäº†", "ç”µè„‘æ•…éšœ", "æ‰“å°æœº", "è®¾å¤‡é—®é¢˜", "ç»´ä¿®", "æ•…éšœ"],
                answer: "è®¾å¤‡æ•…éšœæŠ¥ä¿®æ–¹å¼ï¼š\n1. ç°åœºæŠ¥ä¿®ï¼šå‘ŠçŸ¥æœåŠ¡å°å·¥ä½œäººå‘˜\n2. ç”µè¯æŠ¥ä¿®ï¼š010-12345678\n3. åœ¨çº¿æŠ¥ä¿®ï¼šç™»å½•å›¾ä¹¦é¦†å®˜ç½‘-æœåŠ¡-è®¾å¤‡æŠ¥ä¿®\n\nè¯·è¯´æ˜è®¾å¤‡ä½ç½®ã€æ•…éšœç°è±¡ï¼Œæˆ‘ä»¬ä¼šåœ¨2å°æ—¶å†…å“åº”"
            },
            {
                question: "ç»­å€Ÿå›¾ä¹¦",
                keywords: ["ç»­å€Ÿ", "å»¶æœŸ", "å†å€Ÿä¸€æ¬¡", "å»¶é•¿"],
                answer: "ç»­å€Ÿæ–¹å¼ï¼š\n1. ç™»å½•å›¾ä¹¦é¦†å®˜ç½‘ä¸ªäººä¸­å¿ƒ\n2. é€‰æ‹©è¦ç»­å€Ÿçš„å›¾ä¹¦\n3. ç‚¹å‡»'ç»­å€Ÿ'æŒ‰é’®\n\næ³¨æ„ï¼šæ¯æœ¬ä¹¦å¯ç»­å€Ÿ2æ¬¡ï¼Œæ¯æ¬¡30å¤©ï¼Œåˆ°æœŸå‰7å¤©å¯ç»­å€Ÿ"
            },
            {
                question: "åº§ä½é¢„çº¦",
                keywords: ["é¢„çº¦åº§ä½", "å åº§", "è‡ªä¹ å®¤", "åº§ä½", "é¢„çº¦"],
                answer: "åº§ä½é¢„çº¦æ–¹æ³•ï¼š\n1. å¾®ä¿¡æœç´¢'å›¾ä¹¦é¦†åº§ä½é¢„çº¦'å°ç¨‹åº\n2. é€‰æ‹©æ—¥æœŸå’ŒåŒºåŸŸ\n3. é€‰æ‹©åº§ä½å¹¶ç¡®è®¤é¢„çº¦\n\né¢„çº¦è§„åˆ™ï¼šæå‰1å¤©å¯é¢„çº¦ï¼Œæ¯æ¬¡æœ€é•¿4å°æ—¶ï¼Œè¶…æ—¶15åˆ†é’Ÿè‡ªåŠ¨é‡Šæ”¾"
            }
        ];

        // åˆå§‹åŒ–
        let knowledgeBase = [];
        let formUrl = "https://forms.example.com/library-qa";
        let currentMode = 'user';

        function init() {
            loadKnowledge();
            loadFormUrl();
            renderKnowledgeList();
        }

        function loadKnowledge() {
            const saved = localStorage.getItem('library_knowledge');
            knowledgeBase = saved ? JSON.parse(saved) : defaultKnowledge;
            if (!saved) {
                localStorage.setItem('library_knowledge', JSON.stringify(defaultKnowledge));
            }
        }

        function saveKnowledge() {
            localStorage.setItem('library_knowledge', JSON.stringify(knowledgeBase));
            renderKnowledgeList();
        }

        function loadFormUrl() {
            const saved = localStorage.getItem('form_url');
            if (saved) {
                formUrl = saved;
            }
            document.getElementById('formUrl').value = formUrl;
        }

        function saveFormUrl() {
            formUrl = document.getElementById('formUrl').value;
            localStorage.setItem('form_url', formUrl);
            alert('âœ… é—®å·é“¾æ¥å·²ä¿å­˜');
        }

        function resetKnowledge() {
            if (confirm('ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤çŸ¥è¯†åº“å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰è‡ªå®šä¹‰å†…å®¹ã€‚')) {
                knowledgeBase = defaultKnowledge;
                saveKnowledge();
                alert('âœ… å·²é‡ç½®ä¸ºé»˜è®¤çŸ¥è¯†åº“');
            }
        }

        function renderKnowledgeList() {
            const list = document.getElementById('knowledgeList');
            const count = document.getElementById('knowledgeCount');
            count.textContent = knowledgeBase.length;
            
            if (knowledgeBase.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #9ca3af;">æš‚æ— çŸ¥è¯†åº“</p>';
                return;
            }
            
            list.innerHTML = knowledgeBase.map((item, index) => `
                <div class="knowledge-item">
                    <div class="knowledge-header">
                        <h4 class="knowledge-title">${item.question}</h4>
                        <svg class="icon-lg delete-btn" onclick="deleteKnowledge(${index})" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </div>
                    <p class="knowledge-keywords">
                        <strong>å…³é”®è¯ï¼š</strong>${item.keywords.join('ã€')}
                    </p>
                    <div class="knowledge-answer">${item.answer}</div>
                </div>
            `).join('');
        }

        function deleteKnowledge(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡çŸ¥è¯†å—ï¼Ÿ')) {
                knowledgeBase.splice(index, 1);
                saveKnowledge();
            }
        }

        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    const newKnowledge = jsonData.map(row => ({
                        question: row['é—®é¢˜æ ‡é¢˜'] || row['é—®é¢˜'] || '',
                        keywords: (row['å…³é”®è¯'] || '').split(/[,ï¼Œã€]/).map(k => k.trim()).filter(k => k),
                        answer: row['ç­”æ¡ˆ'] || row['å›ç­”'] || ''
                    })).filter(item => item.question && item.answer && item.keywords.length > 0);

                    if (newKnowledge.length === 0) {
                        alert('âŒ Excelæ ¼å¼ä¸æ­£ç¡®ï¼\nè¯·ç¡®ä¿åŒ…å«ï¼šé—®é¢˜æ ‡é¢˜ã€å…³é”®è¯ã€ç­”æ¡ˆ ä¸‰åˆ—');
                        return;
                    }

                    newKnowledge.forEach(newItem => {
                        const index = knowledgeBase.findIndex(item => item.question === newItem.question);
                        if (index >= 0) {
                            knowledgeBase[index] = newItem;
                        } else {
                            knowledgeBase.push(newItem);
                        }
                    });

                    saveKnowledge();
                    alert(`âœ… æˆåŠŸå¯¼å…¥ ${newKnowledge.length} æ¡çŸ¥è¯†ï¼\nå½“å‰çŸ¥è¯†åº“å…± ${knowledgeBase.length} æ¡`);
                } catch (error) {
                    alert('âŒ å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥Excelæ ¼å¼');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }

        function toggleMode() {
            currentMode = currentMode === 'user' ? 'admin' : 'user';
            const userView = document.getElementById('userView');
            const adminView = document.getElementById('adminView');
            const modeText = document.getElementById('modeText');

            if (currentMode === 'admin') {
                userView.classList.add('hidden');
                adminView.classList.remove('hidden');
                modeText.textContent = 'ç”¨æˆ·æ¨¡å¼';
                renderKnowledgeList();
            } else {
                userView.classList.remove('hidden');
                adminView.classList.add('hidden');
                modeText.textContent = 'ç®¡ç†å‘˜æ¨¡å¼';
            }
        }

        function findAnswer(userQuestion) {
            const question = userQuestion.toLowerCase();
            
            for (let item of knowledgeBase) {
                for (let keyword of item.keywords) {
                    if (question.includes(keyword.toLowerCase())) {
                        return {
                            found: true,
                            answer: item.answer,
                            matchedQuestion: item.question
                        };
                    }
                }
            }
            
            return { found: false };
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text) return;

            const welcomeCard = document.getElementById('welcomeCard');
            const messagesContainer = document.getElementById('messagesContainer');
            const messagesList = document.getElementById('messagesList');

            welcomeCard.classList.add('hidden');
            messagesContainer.classList.remove('hidden');

            const time = new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            
            // ç”¨æˆ·æ¶ˆæ¯
            const userMessageHTML = `
                <div class="message user">
                    <div class="message-content">
                        <div class="message-text">${text}</div>
                        <div class="message-time">${time}</div>
                    </div>
                </div>
            `;
            messagesList.insertAdjacentHTML('beforeend', userMessageHTML);

            input.value = '';

            // æœºå™¨äººå›å¤
            setTimeout(() => {
                const result = findAnswer(text);
                let botMessageHTML;
                
                if (result.found) {
                    botMessageHTML = `
                        <div class="message bot">
                            <div class="message-content">
                                <div class="message-text">${result.answer}</div>
                                <div class="message-time">${time}</div>
                            </div>
                        </div>
                    `;
                } else {
                    botMessageHTML = `
                        <div class="message bot">
                            <div class="message-content">
                                <div class="message-text">æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å›ç­”è¿™ä¸ªé—®é¢˜ã€‚

ä¸ºäº†æ›´å¥½åœ°å¸®åŠ©æ‚¨ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹é“¾æ¥å¡«å†™é—®é¢˜è¯¦æƒ…ï¼Œæˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨ï¼š</div>
                                <a href="${formUrl}" target="_blank" rel="noopener noreferrer" class="feedback-link">
                                    ğŸ“ å¡«å†™é—®é¢˜åé¦ˆè¡¨
                                </a>
                                <div class="message-time">${time}</div>
                            </div>
                        </div>
                    `;
                }
                
                messagesList.insertAdjacentHTML('beforeend', botMessageHTML);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 500);

            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        init();
    </script>
</body>
</html>
